import { useContext } from "react";
import { patchArticlesVote, patchCommentVote } from "../api";
import { AuthContent } from "./AuthContext";
import { useLocation, useNavigate } from "react-router-dom";

function VoteButton({ id, state, initialVotes, newVotes, setNewVotes }) {
  const { user } = useContext(AuthContent);
  const navigate = useNavigate();
  const location = useLocation();
  const handleVote = (delta, location) => {
    if (!user) {
      navigate("/login", { state: { from: location } });
    } else {
      const updatedVotes = newVotes + delta;
      setNewVotes(updatedVotes);
      if (state === "article") {
        patchArticlesVote(id, initialVotes + updatedVotes);
      }
      if (state === "comment") {
        patchCommentVote(id, initialVotes + updatedVotes);
      }
    }
  };
  let btnClasses =
    "flex items-center gap-1 pl-3 pr-4 py-2 text-sm font-medium cursor-pointer transition-colors duration-200 ";
  const buttons = [
    {
      label: "+1",
      color: "bg-[#4B2A18] text-[#F5A524]",
      hover: "hover:bg-[#F5A524] hover:text-[#4B2A18]",
      rounded: "rounded-tl-full rounded-bl-full",
      icon: (
        <svg className="w-5 h-5 fill-current" viewBox="0 0 20 20">
          <path d="M10.6937 18.3107C13.2986 17.7885 16.6667 15.9146 16.6667 11.0689C16.6667 6.65924 13.4389 3.72284 11.1179 2.37361C10.6029 2.07422 10 2.46795 10 3.06367V4.5874C10 5.78895 9.49481 7.98216 8.0911 8.8944C7.37443 9.36015 6.60043 8.66306 6.51333 7.8128L6.44181 7.11461C6.35866 6.30293 5.53201 5.8102 4.8833 6.30507C3.71789 7.1941 2.5 8.7509 2.5 11.0689C2.5 16.9948 6.90741 18.4763 9.11111 18.4763C9.23929 18.4763 9.37399 18.4725 9.51422 18.4644C8.42609 18.3714 6.66667 17.6963 6.66667 15.5131C6.66667 13.8053 7.91256 12.65 8.85918 12.0884C9.11378 11.9374 9.41176 12.1335 9.41176 12.4295V12.9205C9.41176 13.2963 9.55709 13.8836 9.90303 14.2857C10.2945 14.7407 10.8691 14.2641 10.9154 13.6657C10.93 13.4769 11.1199 13.3566 11.2834 13.4521C11.8178 13.7645 12.5 14.4317 12.5 15.5131C12.5 17.2198 11.5592 18.0048 10.6937 18.3107Z" />
        </svg>
      ),
      delta: 1,
    },
    {
      label: "-1",
      color: "bg-[#441729] text-[#F31260]",
      hover: "hover:bg-[#F31260] hover:text-[#4B2A18]",
      rounded: "rounded-tr-full rounded-br-full",
      icon: (
        <svg className="w-5 h-5 fill-current" viewBox="0 0 20 20">
          <path d="M17.4793 9.98841L16.7403 10.1162L16.7403 10.1162L17.4793 9.98841ZM16.8914 6.58861L16.1523 6.71642L16.1523 6.71642L16.8914 6.58861ZM5.78148 3.07851L5.03426 3.0139L5.03426 3.0139L5.78148 3.07851ZM5.10467 10.9057L5.85188 10.9703L5.85188 10.9703L5.10467 10.9057ZM11.6625 15.7916L12.4026 15.6703L12.4026 15.6703L11.6625 15.7916ZM11.1102 12.4211L11.8504 12.2998L11.8504 12.2998L11.1102 12.4211ZM5.58178 12.0782L5.09219 12.6463L5.09219 12.6463L5.58178 12.0782ZM6.78073 13.1113L7.27032 12.5432L7.27032 12.5432L6.78073 13.1113ZM8.76504 16.1563L8.03907 16.3446L8.03907 16.3446L8.76504 16.1563ZM9.16147 17.6845L9.88744 17.4962L9.88744 17.4962L9.16147 17.6845ZM10.5563 18.4224L10.3269 17.7084L10.3269 17.7084L10.5563 18.4224ZM10.6771 18.3836L10.9065 19.0977L10.9065 19.0977L10.6771 18.3836ZM8.21829 14.7572L8.87982 14.4039L8.87982 14.4039L8.21829 14.7572ZM11.5872 17.4365L10.8613 17.2482L10.8613 17.2482L11.5872 17.4365ZM9.7285 18.3657L9.40292 19.0414L9.40292 19.0414L9.7285 18.3657ZM3.30967 2.25047L2.56245 2.18586L2.56245 2.18586L3.30967 2.25047ZM2.5 11.6142L3.24721 11.6788C3.21261 12.079 2.86893 12.3809 2.46767 12.3635C2.0664 12.3462 1.75 12.0159 1.75 11.6142H2.5ZM16.7403 10.1162L16.1523 6.71642L17.6304 6.46081L18.2183 9.86061L16.7403 10.1162ZM11.0375 2.55941H7.16362V1.05941H11.0375V2.55941ZM6.52869 3.14312L5.85188 10.9703L4.35746 10.8411L5.03426 3.0139L6.52869 3.14312ZM16.1523 6.71642C15.7409 4.3374 13.5936 2.55941 11.0375 2.55941V1.05941C14.2835 1.05941 17.0879 3.32409 17.6304 6.46081L16.1523 6.71642ZM10.9223 15.9128L10.3701 12.5424L11.8504 12.2998L12.4026 15.6703L10.9223 15.9128ZM6.07138 11.51L7.27032 12.5432L6.29114 13.6795L5.09219 12.6463L6.07138 11.51ZM9.49102 15.968L9.88744 17.4962L8.4355 17.8728L8.03907 16.3446L9.49102 15.968ZM10.3269 17.7084L10.4477 17.6696L10.9065 19.0977L10.7857 19.1365L10.3269 17.7084ZM8.87982 14.4039C9.14441 14.8992 9.34988 15.4239 9.49102 15.968L8.03907 16.3446C7.92794 15.9162 7.76595 15.5022 7.55676 15.1106L8.87982 14.4039ZM10.4477 17.6696C10.6639 17.6001 10.8128 17.4349 10.8613 17.2482L12.3132 17.6248C12.1308 18.3278 11.5932 18.8771 10.9065 19.0977L10.4477 17.6696ZM9.88744 17.4962C9.90711 17.572 9.96318 17.6463 10.0541 17.6901L9.40292 19.0414C8.92757 18.8123 8.56938 18.3889 8.4355 17.8728L9.88744 17.4962ZM10.0541 17.6901C10.1374 17.7302 10.2364 17.7375 10.3269 17.7084L10.7857 19.1365C10.3306 19.2827 9.83407 19.2492 9.40292 19.0414L10.0541 17.6901ZM11.7947 10.8642H16.1123V12.3642H11.7947V10.8642ZM4.05688 2.31508L3.24721 11.6788L1.75279 11.5496L2.56245 2.18586L4.05688 2.31508ZM3.25 2.21546V11.6142H1.75V2.21546H3.25ZM2.56245 2.18586C2.54516 2.38585 2.70278 2.55941 2.90559 2.55941V1.05941C3.584 1.05941 4.11519 1.64073 4.05688 2.31508L2.56245 2.18586ZM12.4026 15.6703C12.5092 16.3209 12.4787 16.9866 12.3132 17.6248L10.8613 17.2482C10.9744 16.8122 10.9952 16.3573 10.9223 15.9128L12.4026 15.6703ZM7.16362 2.55941C6.83368 2.55941 6.5573 2.8122 6.52869 3.14312L5.03426 3.0139C5.12981 1.90893 6.05394 1.05941 7.16362 1.05941V2.55941ZM7.27032 12.5432C7.83892 13.0331 8.46472 13.6268 8.87982 14.4039L7.55676 15.1106C7.27961 14.5918 6.8351 14.1482 6.29114 13.6795L7.27032 12.5432ZM18.2183 9.86061C18.4443 11.1673 17.4394 12.3642 16.1123 12.3642V10.8642C16.5068 10.8642 16.808 10.5079 16.7403 10.1162L18.2183 9.86061ZM2.90559 2.55941C3.0966 2.55941 3.25 2.40461 3.25 2.21546H1.75C1.75 1.57779 2.26657 1.05941 2.90559 1.05941V2.55941ZM10.3701 12.5424C10.2262 11.6641 10.9032 10.8642 11.7947 10.8642V12.3642C11.8304 12.3642 11.8557 12.3326 11.8504 12.2998L10.3701 12.5424ZM5.85188 10.9703C5.83416 11.1753 5.916 11.3761 6.07138 11.51L5.09219 12.6463C4.57147 12.1976 4.29825 11.5259 4.35746 10.8411L5.85188 10.9703Z" />
        </svg>
      ),
      delta: -1,
    },
  ];

  return (
    <div className="flex flex-row">
      {buttons.map((btn, index) => (
        <button
          key={index}
          onClick={() => handleVote(btn.delta, location)}
          className={`${btnClasses} ${btn.rounded} ${btn.color} ${btn.hover} ${
            !user ? "opacity-60 cursor-pointer" : ""
          } `}
          aria-label={btn.label === "+1" ? "addVote" : "minusVote"}
        >
          {btn.icon}
          <span>{btn.delta}</span>
        </button>
      ))}
    </div>
  );
}

export default VoteButton;
